Router.map ->
  @route 'Home',
    path: '/'
    template: 'allTiles'
    waitOn: ->
      Meteor.subscribe 'Tiles'
      Meteor.subscribe 'Users'
    data: ->
      return unless @ready() is true
      categories = {}
      console.log "Creating Tile data object...."
      for tile in Tiles.find({}, {'sort': {'category': 1}}).fetch()
        if !categories[tile.category]?
          categories[tile.category] =
            tiles: [ tile ]
        else
          categories[tile.category].tiles.push tile
      
      category_list = []
      numCategories = (c for c of categories).length
      delta_hue = 360/numCategories
      hue = 0
      for title, cat of categories
        category_list.push
          title: title
          tiles: cat.tiles
          color: "hsl(#{hue}, 100%, 50%)"
        hue += delta_hue
      #console.log category_list 
      return {categories: category_list}
